import{m as T,S as L,k as $,e as M,j as re,t as W,g as N,C as ie,r as le}from"./useBranding-C51QoB-t.js";import{g as O}from"./utils.esm-CMazHLgs.js";import{C as de}from"./Button-BNBtSKqQ.js";import{F as A}from"./module-WEXc1Yw_.js";import{_ as g,x as l,n as r,o,p as d,m as U,t as _,e as f,a as p,l as P,g as m,z as v,H as j,i as x,q as C,k as V,b as ce,F as w,j as E,af as Y,L as H,U as ue,f as q,ag as me}from"./_plugin-vue_export-helper-n_vHXFlc.js";import{G as pe,s as X,H as ge,R as he,y as K,J as _e,_ as fe}from"./typing-Dhk99rRl.js";import{B as F,ah as be}from"./Validators-0vUS0OnA.js";import{c as J,s as ye,I as z,d as ve,u as Ce}from"./widget-DTIWWfiN.js";import Te from"./EmojiInput-8IkZz3o1.js";import{j as ke,g as Se}from"./sharedFrameEvents-0qZ2yOho.js";import{u as D}from"./vue-dompurify-html-CEAHYyWB.js";import{e as we,r as Ee,u as Ae}from"./index-UYK3fwMr.js";import{S as Ie}from"./StarRating-C30wnY7r.js";import{A as xe,w as Re,D as Me}from"./index-DzK6ljgP.js";import{M as Z}from"./constants-lVAyZKq6.js";import"./Icon-D1o1yyYK.js";import"./index-DN3rM4CW.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Branding-CCCFOlLc.js";const Fe={name:"FooterReplyTo",components:{FluentIcon:A},props:{inReplyTo:{type:Object,default:()=>{}}},emits:["dismiss"],computed:{replyToAttachment(){var n,s;if(!((s=(n=this.inReplyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.inReplyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}}},Oe={class:"mb-2.5 rounded-[7px] bg-n-slate-3 px-2 py-1.5 text-sm text-n-slate-11 flex items-center gap-2"},Be={class:"items-center flex-grow truncate"};function Le(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",Oe,[d("div",Be,[d("strong",null,_(e.$t("FOOTER_REPLY_TO.REPLY_TO")),1),U(" "+_(s.inReplyTo.content||t.replyToAttachment),1)]),d("button",{class:"items-end flex-shrink-0 p-1 rounded-md hover:bg-n-slate-5",onClick:n[0]||(n[0]=c=>e.$emit("dismiss"))},[f(a,{icon:"dismiss",size:"12"})])])}const je=g(Fe,[["render",Le],["__file","/app/app/javascript/widget/components/FooterReplyTo.vue"]]),Ue={components:{FluentIcon:A,FileUpload:pe,Spinner:L},props:{onAttach:{type:Function,default:()=>{}}},data(){return{isUploading:!1}},computed:{...T({globalConfig:"globalConfig/get",shouldShowFilePicker:"appConfig/getShouldShowFilePicker"}),fileUploadSizeLimit(){return $},allowedFileTypes(){return re}},mounted(){document.addEventListener("paste",this.handleClipboardPaste)},unmounted(){document.removeEventListener("paste",this.handleClipboardPaste)},methods:{handleClipboardPaste(e){if(!this.shouldShowFilePicker)return;const n=(e.clipboardData||e.originalEvent.clipboardData).items;Array.from(n).forEach(u=>{if(u.kind==="file"){e.preventDefault();const i=u.getAsFile();this.$refs.upload.add(i)}})},getFileType(e){return e.includes("image")?"image":"file"},async onFileUpload(e){this.globalConfig.directUploadsEnabled?await this.onDirectFileUpload(e):await this.onIndirectFileUpload(e)},async onDirectFileUpload(e){if(e){this.isUploading=!0;try{if(X(e,$)){const{websiteToken:n}=window.chatwootWebChannel;new ge.DirectUpload(e.file,`/api/v1/widget/direct_uploads?website_token=${n}`,{directUploadWillCreateBlobWithXHR:u=>{u.setRequestHeader("X-Auth-Token",window.authToken)}}).create((u,i)=>{u?M.emit(F.SHOW_ALERT,{message:u}):this.onAttach({file:i.signed_id,...this.getLocalFileAttributes(e)})})}else M.emit(F.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},async onIndirectFileUpload(e){if(e){this.isUploading=!0;try{X(e,$)?await this.onAttach({file:e.file,...this.getLocalFileAttributes(e)}):M.emit(F.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},getLocalFileAttributes(e){return{thumbUrl:window.URL.createObjectURL(e.file),fileType:this.getFileType(e.type)}}}},Pe={class:"min-h-8 min-w-8 flex items-center justify-center"};function Ve(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner"),h=l("FileUpload");return o(),p(h,{ref:"upload",size:4096*2048,accept:t.allowedFileTypes,data:{direct_upload_url:"/api/v1/widget/direct_uploads",direct_upload:!0},onInputFile:t.onFileUpload},{default:P(()=>[d("button",Pe,[i.isUploading.image?m("v-if",!0):(o(),p(a,{key:0,icon:"attach"})),i.isUploading?(o(),p(c,{key:1,size:"small"})):m("v-if",!0)])]),_:1},8,["accept","onInputFile"])}const De=g(Ue,[["render",Ve],["__file","/app/app/javascript/widget/components/ChatAttachment.vue"]]),$e={components:{FluentIcon:A,Spinner:L},props:{loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},color:{type:String,default:"#6e6f73"}}},Ne=["disabled"];function We(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner");return o(),r("button",{type:"submit",disabled:s.disabled,class:"min-h-8 min-w-8 flex items-center justify-center ml-1"},[s.loading?(o(),p(c,{key:1,size:"small"})):(o(),p(a,{key:0,icon:"send",style:v(`color: ${s.color}`)},null,8,["style"]))],8,Ne)}const ze=g($e,[["render",We],["__file","/app/app/javascript/widget/components/ChatSendButton.vue"]]),He={name:"ChatInputWrap",components:{ChatAttachmentButton:De,ChatSendButton:ze,EmojiInput:Te,FluentIcon:A,ResizableTextArea:he},mixins:[J],props:{onSendMessage:{type:Function,default:()=>{}},onSendAttachment:{type:Function,default:()=>{}}},data(){return{userInput:"",showEmojiPicker:!1,isFocused:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor",isWidgetOpen:"appConfig/getIsWidgetOpen",shouldShowFilePicker:"appConfig/getShouldShowFilePicker",shouldShowEmojiPicker:"appConfig/getShouldShowEmojiPicker"}),showAttachment(){return this.shouldShowFilePicker&&this.hasAttachmentsEnabled&&this.userInput.length===0},showSendButton(){return this.userInput.length>0}},watch:{isWidgetOpen(e){e&&this.focusInput()}},unmounted(){document.removeEventListener("keypress",this.handleEnterKeyPress)},mounted(){document.addEventListener("keypress",this.handleEnterKeyPress),this.isWidgetOpen&&this.focusInput()},methods:{onBlur(){this.isFocused=!1},onFocus(){this.isFocused=!0},handleButtonClick(){this.userInput&&this.userInput.trim()&&this.onSendMessage(this.userInput),this.userInput="",this.focusInput()},handleEnterKeyPress(e){e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),this.handleButtonClick())},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},hideEmojiPicker(e){this.showEmojiPicker&&(e.stopPropagation(),this.toggleEmojiPicker())},emojiOnClick(e){this.userInput=`${this.userInput}${e} `},onTypingOff(){this.toggleTyping("off")},onTypingOn(){this.toggleTyping("on")},toggleTyping(e){this.$store.dispatch("conversation/toggleUserTyping",{typingStatus:e})},focusInput(){this.$refs.chatInput.focus()}}},qe={class:"flex items-center ltr:pl-2 rtl:pr-2"},Ge=["aria-label"];function Ye(e,n,s,u,i,t){const a=l("ResizableTextArea"),c=l("ChatAttachmentButton"),h=l("FluentIcon"),b=l("EmojiInput"),k=l("ChatSendButton"),R=j("on-clickaway");return o(),r("div",{class:C(["items-center flex ltr:pl-3 rtl:pr-3 ltr:pr-2 rtl:pl-2 rounded-[7px] transition-all duration-200 bg-n-background !shadow-[0_0_0_1px,0_0_2px_3px]",{"!shadow-n-brand dark:!shadow-n-brand":i.isFocused,"!shadow-n-strong dark:!shadow-n-strong":!i.isFocused}]),onKeydown:n[2]||(n[2]=V((...I)=>t.hideEmojiPicker&&t.hideEmojiPicker(...I),["esc"]))},[f(a,{id:"chat-input",ref:"chatInput",modelValue:i.userInput,"onUpdate:modelValue":n[0]||(n[0]=I=>i.userInput=I),rows:1,"aria-label":e.$t("CHAT_PLACEHOLDER"),placeholder:e.$t("CHAT_PLACEHOLDER"),class:"user-message-input reset-base",onTypingOff:t.onTypingOff,onTypingOn:t.onTypingOn,onFocus:t.onFocus,onBlur:t.onBlur},null,8,["modelValue","aria-label","placeholder","onTypingOff","onTypingOn","onFocus","onBlur"]),d("div",qe,[t.showAttachment?(o(),p(c,{key:0,class:"text-n-slate-12","on-attach":s.onSendAttachment},null,8,["on-attach"])):m("v-if",!0),e.shouldShowEmojiPicker&&e.hasEmojiPickerEnabled?(o(),r("button",{key:1,class:"flex items-center justify-center min-h-8 min-w-8","aria-label":e.$t("EMOJI.ARIA_LABEL"),onClick:n[1]||(n[1]=(...I)=>t.toggleEmojiPicker&&t.toggleEmojiPicker(...I))},[f(h,{icon:"emoji",class:C(["transition-all duration-150",{"text-n-slate-12":!i.showEmojiPicker,"text-n-brand":i.showEmojiPicker}])},null,8,["class"])],8,Ge)):m("v-if",!0),e.shouldShowEmojiPicker&&i.showEmojiPicker?x((o(),p(b,{key:2,"on-click":t.emojiOnClick,onKeydown:V(t.hideEmojiPicker,["esc"])},null,8,["on-click","onKeydown"])),[[R,t.hideEmojiPicker]]):m("v-if",!0),t.showSendButton?(o(),p(k,{key:3,color:e.widgetColor,onClick:t.handleButtonClick},null,8,["color","onClick"])):m("v-if",!0)])],34)}const Xe=g(He,[["render",Ye],["__scopeId","data-v-d1369cd1"],["__file","/app/app/javascript/widget/components/ChatInputWrap.vue"]]),Ke={components:{ChatInputWrap:Xe,CustomButton:de,FooterReplyTo:je},setup(){return{router:be()}},data(){return{inReplyTo:null}},computed:{...T({conversationAttributes:"conversationAttributes/getConversationParams",widgetColor:"appConfig/getWidgetColor",conversationSize:"conversation/getConversationSize",currentUser:"contacts/getCurrentUser",isWidgetStyleFlat:"appConfig/isWidgetStyleFlat"}),textColor(){return O(this.widgetColor)},hideReplyBox(){const{allowMessagesAfterResolved:e}=window.chatwootWebChannel,{status:n}=this.conversationAttributes;return!e&&n==="resolved"},showEmailTranscriptButton(){return this.hasEmail},hasEmail(){return this.currentUser&&this.currentUser.has_email},hasReplyTo(){return this.inReplyTo&&(this.inReplyTo.content||this.inReplyTo.attachments)}},mounted(){M.on(F.TOGGLE_REPLY_TO_MESSAGE,this.toggleReplyTo)},methods:{...W("conversation",["sendMessage","sendAttachment"]),...W("conversationAttributes",["getAttributes"]),async handleSendMessage(e){await this.sendMessage({content:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null,this.conversationSize===0&&this.getAttributes()},async handleSendAttachment(e){await this.sendAttachment({attachment:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null},startNewConversation(){this.router.replace({name:"prechat-form"}),z.sendMessage({event:"onEvent",eventIdentifier:ke,data:{hasConversation:!0}})},toggleReplyTo(e){this.inReplyTo=e},async sendTranscript(){if(this.hasEmail)try{await ye(),M.emit(F.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_SUCCESS"),type:"success"})}catch{M.$emit(F.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_ERROR")})}}}},Je={key:1};function Ze(e,n,s,u,i,t){const a=l("FooterReplyTo"),c=l("ChatInputWrap"),h=l("CustomButton");return t.hideReplyBox?(o(),r("div",Je,[f(h,{class:"font-medium",block:"","bg-color":e.widgetColor,"text-color":t.textColor,onClick:t.startNewConversation},{default:P(()=>[U(_(e.$t("START_NEW_CONVERSATION")),1)]),_:1},8,["bg-color","text-color","onClick"]),t.showEmailTranscriptButton?(o(),p(h,{key:0,type:"clear",class:"font-normal",onClick:t.sendTranscript},{default:P(()=>[U(_(e.$t("EMAIL_TRANSCRIPT.BUTTON_TEXT")),1)]),_:1},8,["onClick"])):m("v-if",!0)])):(o(),r("footer",{key:0,class:C(["relative z-50 mb-1",{"rounded-lg":!e.isWidgetStyleFlat,"pt-2.5 shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.05)] dark:shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.15)] rounded-t-none":t.hasReplyTo}])},[t.hasReplyTo?(o(),p(a,{key:0,"in-reply-to":i.inReplyTo,onDismiss:n[0]||(n[0]=b=>i.inReplyTo=null)},null,8,["in-reply-to"])):m("v-if",!0),f(c,{class:"shadow-sm","on-send-message":t.handleSendMessage,"on-send-attachment":t.handleSendAttachment},null,8,["on-send-message","on-send-attachment"])],2))}const Qe=g(Ke,[["render",Ze],["__file","/app/app/javascript/widget/components/ChatFooter.vue"]]),et={name:"UserMessageBubble",props:{message:{type:String,default:""},widgetColor:{type:String,default:""}},setup(){const{formatMessage:e}=D();return{formatMessage:e}},computed:{textColor(){return O(this.widgetColor)}}};function tt(e,n,s,u,i,t){const a=j("dompurify-html");return x((o(),r("div",{class:"chat-bubble user",style:v({background:s.widgetColor,color:t.textColor})},null,4)),[[a,u.formatMessage(s.message,!1)]])}const st=g(et,[["render",tt],["__scopeId","data-v-4c2cb76a"],["__file","/app/app/javascript/widget/components/UserMessageBubble.vue"]]),nt={name:"MessageReplyButton",components:{FluentIcon:A}},ot={class:"p-1 mb-1 rounded-full text-n-slate-11 bg-n-slate-3 hover:text-n-slate-12"};function at(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("button",ot,[f(a,{icon:"arrow-reply",size:"11",class:"flex-shrink-0"})])}const Q=g(nt,[["render",at],["__file","/app/app/javascript/widget/components/MessageReplyButton.vue"]]),rt={props:{url:{type:String,default:""},thumb:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],methods:{onImgError(){this.$emit("error")}}},it=["href"],lt={class:"wrap"},dt=["src"],ct={class:"time"};function ut(e,n,s,u,i,t){return o(),r("a",{href:s.url,target:"_blank",rel:"noreferrer noopener nofollow",class:"image"},[d("div",lt,[d("img",{src:s.thumb,alt:"Picture message",onError:n[0]||(n[0]=(...a)=>t.onImgError&&t.onImgError(...a))},null,40,dt),d("span",ct,_(s.readableTime),1)])],8,it)}const ee=g(rt,[["render",ut],["__scopeId","data-v-71029c86"],["__file","/app/app/javascript/widget/components/ImageBubble.vue"]]),mt={__name:"VideoBubble",props:{url:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],setup(e,{expose:n,emit:s}){n();const u=s,t={emit:u,onVideoError:()=>{u("error")}};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}},pt={class:"relative block max-w-full"},gt=["src"],ht={class:"absolute text-xs text-white dark:text-white right-3 bottom-1 whitespace-nowrap"};function _t(e,n,s,u,i,t){return o(),r("div",pt,[d("video",{class:"w-full max-w-[250px] h-auto",src:s.url,controls:"",onError:u.onVideoError},null,40,gt),d("span",ht,_(s.readableTime),1)])}const te=g(mt,[["render",_t],["__file","/app/app/javascript/widget/components/VideoBubble.vue"]]),ft={components:{FluentIcon:A},props:{url:{type:String,default:""},isInProgress:{type:Boolean,default:!1},widgetColor:{type:String,default:""},isUserBubble:{type:Boolean,default:!1}},computed:{title(){return this.isInProgress?this.$t("COMPONENTS.FILE_BUBBLE.UPLOADING"):decodeURI(this.fileName)},fileName(){return this.url.substring(this.url.lastIndexOf("/")+1)},contrastingTextColor(){return O(this.widgetColor)},textColor(){return this.isUserBubble&&this.widgetColor?this.contrastingTextColor:""}},methods:{openLink(){window.open(this.url,"_blank").focus()}}},bt={class:"file flex flex-row items-center p-3 cursor-pointer"},yt={class:"ltr:pr-1 rtl:pl-1"},vt={class:"leading-none mb-1"},Ct=["href"];function Tt(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",bt,[d("div",{class:"icon-wrap",style:v({color:t.textColor})},[f(a,{icon:"document",size:"28"})],4),d("div",yt,[d("div",{class:C(["m-0 font-medium text-sm",{"text-n-slate-12":!s.isUserBubble}]),style:v({color:t.textColor})},_(t.title),7),d("div",vt,[d("a",{class:"download",rel:"noreferrer noopener nofollow",target:"_blank",style:v({color:t.textColor}),href:s.url},_(e.$t("COMPONENTS.FILE_BUBBLE.DOWNLOAD")),13,Ct)])])])}const se=g(ft,[["render",Tt],["__scopeId","data-v-ef449ed8"],["__file","/app/app/javascript/widget/components/FileBubble.vue"]]),ne={computed:{messageContentAttributes(){const{content_attributes:e={}}=this.message;return e},hasAttachments(){return!!(this.message.attachments&&this.message.attachments.length>0)}}},kt={name:"AgentMessage",components:{FluentIcon:A},props:{replyTo:{type:Object,default:()=>{}}},data(){return{timeOutID:null}},computed:{replyToAttachment(){var n,s;if(!((s=(n=this.replyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.replyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}},unmounted(){clearTimeout(this.timeOutID)},methods:{navigateTo(e){const n=`cwmsg-${e}`;this.$nextTick(()=>{const s=document.getElementById(n);s.scrollIntoView(),s.classList.add("bg-n-slate-3","dark:bg-n-solid-3"),this.timeOutID=setTimeout(()=>{s.classList.remove("bg-n-slate-3","dark:bg-n-solid-3")},500)})}}},St={class:"truncate max-w-[8rem]"};function wt(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("button",{class:"px-1.5 py-0.5 rounded-md text-n-slate-11 bg-n-slate-4 opacity-60 hover:opacity-100 cursor-pointer flex items-center gap-1.5",onClick:n[0]||(n[0]=c=>t.navigateTo(s.replyTo.id))},[f(a,{icon:"arrow-reply",size:"12",class:"flex-shrink-0"}),d("div",St,_(s.replyTo.content||t.replyToAttachment),1)])}const oe=g(kt,[["render",wt],["__file","/app/app/javascript/widget/components/ReplyToChip.vue"]]),Et={name:"DragWrapper",props:{direction:{type:String,required:!0,validator:e=>["left","right"].includes(e)},disabled:{type:Boolean,default:!1}},emits:["dragged"],data(){return{startX:null,dragDistance:0,threshold:50}},methods:{handleTouchStart(e){this.disabled||(this.startX=e.touches[0].clientX)},handleTouchMove(e){if(this.disabled)return;let s=e.touches[0].clientX-this.startX;this.direction==="right"?this.dragDistance=Math.min(this.threshold,s):this.direction==="left"&&(this.dragDistance=Math.max(-this.threshold,s))},resetPosition(){(this.dragDistance>=this.threshold&&this.direction==="right"||this.dragDistance<=-this.threshold&&this.direction==="left")&&this.$emit("dragged",this.direction),this.dragDistance=0}}};function At(e,n,s,u,i,t){return o(),r("div",{style:v({transform:`translateX(${i.dragDistance}px)`}),class:"will-change-transform",onTouchstart:n[0]||(n[0]=(...a)=>t.handleTouchStart&&t.handleTouchStart(...a)),onTouchmove:n[1]||(n[1]=(...a)=>t.handleTouchMove&&t.handleTouchMove(...a)),onTouchend:n[2]||(n[2]=(...a)=>t.resetPosition&&t.resetPosition(...a))},[ce(e.$slots,"default")],36)}const It=g(Et,[["render",At],["__file","/app/app/javascript/widget/components/DragWrapper.vue"]]),xt={name:"UserMessage",components:{UserMessageBubble:st,MessageReplyButton:Q,ImageBubble:ee,VideoBubble:te,FileBubble:se,FluentIcon:A,ReplyToChip:oe,DragWrapper:It},mixins:[ne],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),isInProgress(){const{status:e=""}=this.message;return e==="in_progress"},showTextBubble(){const{message:e}=this;return!!e.content},readableTime(){const{created_at:e=""}=this.message;return K(e)},isFailed(){const{status:e=""}=this.message;return e==="failed"},errorMessage(){const{meta:e}=this.message;return e?e.error:this.$t("COMPONENTS.MESSAGE_BUBBLE.ERROR_MESSAGE")},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{async retrySendMessage(){await this.$store.dispatch("conversation/sendMessageWithData",this.message)},onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){M.emit(F.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},Rt={class:"user-message-wrap group"},Mt={class:"flex gap-1 user-message"},Ft={key:0,class:"flex justify-end mt-2 mb-1 text-xs"},Ot={class:"flex justify-end gap-1"},Bt={class:"flex flex-col justify-end"},Lt={key:1,class:"flex justify-end px-4 py-2 text-n-ruby-9 align-middle"},jt=["title"];function Ut(e,n,s,u,i,t){const a=l("ReplyToChip"),c=l("MessageReplyButton"),h=l("UserMessageBubble"),b=l("ImageBubble"),k=l("VideoBubble"),R=l("FileBubble"),I=l("DragWrapper"),B=l("FluentIcon");return o(),r("div",Rt,[d("div",Mt,[d("div",{class:C(["message-wrap",{"in-progress":t.isInProgress,"is-failed":t.isFailed}])},[t.hasReplyTo?(o(),r("div",Ft,[f(a,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("v-if",!0),d("div",Ot,[d("div",Bt,[!t.isInProgress&&!t.isFailed?(o(),p(c,{key:0,class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])):m("v-if",!0)]),f(I,{direction:"left",onDragged:t.toggleReply},{default:P(()=>[t.showTextBubble?(o(),p(h,{key:0,message:s.message.content,status:s.message.status,"widget-color":e.widgetColor},null,8,["message","status","widget-color"])):m("v-if",!0),e.hasAttachments?(o(),r("div",{key:1,class:"chat-bubble has-attachment user",style:v({backgroundColor:e.widgetColor})},[(o(!0),r(w,null,E(s.message.attachments,y=>(o(),r("div",{key:y.id},[y.file_type==="image"&&!i.hasImageError?(o(),p(b,{key:0,url:y.data_url,thumb:y.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("v-if",!0),y.file_type==="video"&&!i.hasVideoError?(o(),p(k,{key:1,url:y.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):(o(),p(R,{key:2,url:y.data_url,"is-in-progress":t.isInProgress,"widget-color":e.widgetColor,"is-user-bubble":""},null,8,["url","is-in-progress","widget-color"]))]))),128))],4)):m("v-if",!0)]),_:1},8,["onDragged"])]),t.isFailed?(o(),r("div",Lt,[e.hasAttachments?m("v-if",!0):(o(),r("button",{key:0,title:e.$t("COMPONENTS.MESSAGE_BUBBLE.RETRY"),class:"inline-flex items-center justify-center ltr:ml-2 rtl:mr-2",onClick:n[0]||(n[0]=(...y)=>t.retrySendMessage&&t.retrySendMessage(...y))},[f(B,{icon:"arrow-clockwise",size:"14"})],8,jt))])):m("v-if",!0)],2)])])}const ae=g(xt,[["render",Ut],["__file","/app/app/javascript/widget/components/UserMessage.vue"]]),Pt={components:{},props:{action:{type:Object,default:()=>{}}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},isLink(){return this.action.type==="link"}},methods:{onClick(){this.action.type==="postback"&&z.isIFrame()&&z.sendMessage({event:"postback",data:{payload:this.action.payload}})}}},Vt=["href"];function Dt(e,n,s,u,i,t){return t.isLink?(o(),r("a",{key:s.action.uri,class:"action-button button",href:s.action.uri,style:v({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),target:"_blank",rel:"noopener nofollow noreferrer"},_(s.action.text),13,Vt)):(o(),r("button",{key:s.action.payload,class:"action-button button !bg-n-background dark:!bg-n-alpha-black1 text-n-brand",style:v({borderColor:e.widgetColor,color:e.widgetColor}),onClick:n[0]||(n[0]=(...a)=>t.onClick&&t.onClick(...a))},_(s.action.text),5))}const $t=g(Pt,[["render",Dt],["__scopeId","data-v-01a0af2d"],["__file","/app/app/javascript/shared/components/CardButton.vue"]]),Nt={components:{CardButton:$t},props:{title:{type:String,default:""},description:{type:String,default:""},mediaUrl:{type:String,default:""},actions:{type:Array,default:()=>[]}}},Wt={class:"card-message chat-bubble agent bg-n-background dark:bg-n-solid-3 max-w-56 rounded-lg overflow-hidden"},zt=["src"],Ht={class:"card-body"},qt={class:"!text-base !font-medium !mt-1 !mb-1 !leading-[1.5] text-n-slate-12"},Gt={class:"!mb-1 text-n-slate-11"};function Yt(e,n,s,u,i,t){const a=l("CardButton");return o(),r("div",Wt,[d("img",{class:"w-full object-contain max-h-[150px] rounded-[5px]",src:s.mediaUrl},null,8,zt),d("div",Ht,[d("h4",qt,_(s.title),1),d("p",Gt,_(s.description),1),(o(!0),r(w,null,E(s.actions,c=>(o(),p(a,{key:c.id,action:c},null,8,["action"]))),128))])])}const Xt=g(Nt,[["render",Yt],["__file","/app/app/javascript/shared/components/ChatCard.vue"]]),Kt={props:{buttonLabel:{type:String,default:""},items:{type:Array,default:()=>[]},submittedValues:{type:Array,default:()=>[]}},emits:["submit"],data(){return{formValues:{},hasSubmitted:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},isFormValid(){return this.items.reduce((e,{name:n})=>!!this.formValues[n]&&e,!0)}},mounted(){this.submittedValues.length?this.updateFormValues():this.setFormDefaults()},methods:{onSubmitClick(){this.hasSubmitted=!0},onSubmit(){this.isFormValid&&this.$emit("submit",this.formValues)},buildFormObject(e){return e.reduce((n,s)=>({...n,[s.name]:s.value||s.default}),{})},updateFormValues(){this.formValues=this.buildFormObject(this.submittedValues)},setFormDefaults(){this.formValues=this.buildFormObject(this.items)}}},Jt={class:"form chat-bubble agent w-full p-4 bg-n-background dark:bg-n-solid-3"},Zt={class:"text-n-slate-12"},Qt=["onUpdate:modelValue","type","pattern","title","required","name","placeholder","disabled"],es=["onUpdate:modelValue","required","pattern","title","type","name","placeholder","disabled"],ts=["onUpdate:modelValue","required","title","name","placeholder","disabled"],ss=["onUpdate:modelValue","required"],ns=["value"],os={class:"error-message"};function as(e,n,s,u,i,t){return o(),r("div",Jt,[d("form",{onSubmit:n[1]||(n[1]=q((...a)=>t.onSubmit&&t.onSubmit(...a),["prevent"]))},[(o(!0),r(w,null,E(s.items,a=>(o(),r("div",{key:a.key,class:C(["pb-2 w-full",{"has-submitted":i.hasSubmitted}])},[d("label",Zt,_(a.label),1),a.type==="email"?x((o(),r("input",{key:0,"onUpdate:modelValue":c=>i.formValues[a.name]=c,type:a.type,pattern:a.regex,title:a.title,required:a.required&&"required",name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Qt)),[[Y,i.formValues[a.name]]]):a.type==="text"?x((o(),r("input",{key:1,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required",pattern:a.pattern,title:a.title,type:a.type,name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,es)),[[Y,i.formValues[a.name]]]):a.type==="text_area"?x((o(),r("textarea",{key:2,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required",title:a.title,name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,ts)),[[H,i.formValues[a.name]]]):a.type==="select"?x((o(),r("select",{key:3,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required"},[(o(!0),r(w,null,E(a.options,c=>(o(),r("option",{key:c.key,value:c.value},_(c.label),9,ns))),128))],8,ss)),[[ue,i.formValues[a.name]]]):m("v-if",!0),d("span",os,_(a.pattern_error||e.$t("CHAT_FORM.INVALID.FIELD")),1)],2))),128)),s.submittedValues.length?m("v-if",!0):(o(),r("button",{key:0,class:"button block",type:"submit",style:v({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...a)=>t.onSubmitClick&&t.onSubmitClick(...a))},_(s.buttonLabel||e.$t("COMPONENTS.FORM_BUBBLE.SUBMIT")),5))],32)])}const rs=g(Kt,[["render",as],["__scopeId","data-v-859c65c5"],["__file","/app/app/javascript/shared/components/ChatForm.vue"]]),is={components:{},props:{action:{type:Object,default:()=>{}},isSelected:{type:Boolean,default:!1}},emits:["optionSelect"],computed:{...T({widgetColor:"appConfig/getWidgetColor"})},methods:{onClick(){this.$emit("optionSelect",this.action)}}};function ls(e,n,s,u,i,t){return o(),r("li",{class:C(["option",{"is-selected":s.isSelected}]),style:v({borderColor:e.widgetColor})},[d("button",{class:"option-button button",onClick:n[0]||(n[0]=(...a)=>t.onClick&&t.onClick(...a))},[d("span",{style:v({color:e.widgetColor})},_(s.action.title),5)])],6)}const ds=g(is,[["render",ls],["__scopeId","data-v-f8d42b25"],["__file","/app/app/javascript/shared/components/ChatOption.vue"]]),cs={components:{ChatOption:ds},props:{title:{type:String,default:""},options:{type:Array,default:()=>[]},selected:{type:String,default:""},hideFields:{type:Boolean,default:!1}},emits:["optionSelect"],setup(){const{formatMessage:e}=D();return{formatMessage:e}},methods:{isSelected(e){return this.selected===e.id},onClick(e){this.$emit("optionSelect",e)}}},us={class:"chat-bubble agent max-w-64 !py-2 !px-4 rounded-lg overflow-hidden mt-1 bg-n-background dark:bg-n-solid-3"},ms={class:"text-n-slate-12 text-sm font-normal my-1 leading-[1.5]"},ps={class:"text-n-slate-12"},gs={key:0,class:"w-full"};function hs(e,n,s,u,i,t){const a=l("ChatOption"),c=j("dompurify-html");return o(),r("div",us,[d("h4",ms,[x(d("div",ps,null,512),[[c,u.formatMessage(s.title,!1)]])]),s.hideFields?m("v-if",!0):(o(),r("ul",gs,[(o(!0),r(w,null,E(s.options,h=>(o(),p(a,{key:h.id,action:h,"is-selected":t.isSelected(h),class:"list-none p-0",onOptionSelect:t.onClick},null,8,["action","is-selected","onOptionSelect"]))),128))]))])}const _s=g(cs,[["render",hs],["__file","/app/app/javascript/shared/components/ChatOptions.vue"]]),fs={components:{FluentIcon:A},props:{items:{type:Array,default:()=>[]}},setup(){const{truncateMessage:e}=D();return{truncateMessage:e}}},bs={key:0,class:"chat-bubble agent bg-n-background dark:bg-n-solid-3"},ys=["href"],vs={class:"flex items-center text-n-slate-12 font-medium"},Cs={class:"text-n-slate-12"},Ts={class:"block mt-1 text-n-slate-12"};function ks(e,n,s,u,i,t){const a=l("FluentIcon");return s.items.length?(o(),r("div",bs,[(o(!0),r(w,null,E(s.items,c=>(o(),r("div",{key:c.link,class:"border-b border-solid border-n-weak text-sm py-2 px-0 last:border-b-0"},[d("a",{href:c.link,target:"_blank",rel:"noopener noreferrer nofollow",class:"text-n-slate-12 no-underline"},[d("span",vs,[f(a,{icon:"link",class:"ltr:mr-1 rtl:ml-1 text-n-slate-12"}),d("span",Cs,_(c.title),1)]),d("span",Ts,_(u.truncateMessage(c.description)),1)],8,ys)]))),128))])):m("v-if",!0)}const Ss=g(fs,[["render",ks],["__file","/app/app/javascript/widget/components/template/Article.vue"]]),ws={components:{FluentIcon:A,Spinner:L},props:{messageId:{type:Number,required:!0},messageContentAttributes:{type:Object,default:()=>{}}},setup(){return{v$:Ae()}},data(){return{email:"",isUpdating:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},hasSubmitted(){return this.messageContentAttributes&&this.messageContentAttributes.submitted_email}},validations:{email:{required:Ee,email:we}},methods:{async onSubmit(){if(!this.v$.$invalid){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{email:this.email,messageId:this.messageId})}catch{}finally{this.isUpdating=!1}}}}},Es=["placeholder"],As=["disabled"];function Is(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner");return o(),r("div",null,[t.hasSubmitted?m("v-if",!0):(o(),r("form",{key:0,class:"email-input-group h-10 flex my-2 mx-0 min-w-[200px]",onSubmit:n[3]||(n[3]=q((...h)=>t.onSubmit&&t.onSubmit(...h),["prevent"]))},[x(d("input",{"onUpdate:modelValue":n[0]||(n[0]=h=>i.email=h),type:"email",placeholder:e.$t("EMAIL_PLACEHOLDER"),class:C({error:u.v$.email.$error}),onInput:n[1]||(n[1]=(...h)=>u.v$.email.$touch&&u.v$.email.$touch(...h)),onKeydown:n[2]||(n[2]=V((...h)=>t.onSubmit&&t.onSubmit(...h),["enter"]))},null,42,Es),[[H,i.email]]),d("button",{class:"button small",disabled:u.v$.email.$invalid,style:v({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating?(o(),p(c,{key:1,class:"mx-2"})):(o(),p(a,{key:0,icon:"chevron-right"}))],12,As)],32))])}const xs=g(ws,[["render",Is],["__scopeId","data-v-9c89825b"],["__file","/app/app/javascript/widget/components/template/EmailInput.vue"]]),Rs={components:{Spinner:L,FluentIcon:A,StarRating:Ie},props:{messageContentAttributes:{type:Object,default:()=>{}},messageId:{type:Number,required:!0},displayType:{type:String,default:N.EMOJI},message:{type:String,default:""}},data(){return{email:"",ratings:ie,selectedRating:null,isUpdating:!1,feedback:""}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),isRatingSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.rating},isFeedbackSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.feedback_message},isButtonDisabled(){return!(this.selectedRating&&this.feedback)},textColor(){return O(this.widgetColor)},title(){return this.isRatingSubmitted?this.$t("CSAT.SUBMITTED_TITLE"):this.message||this.$t("CSAT.TITLE")},isEmojiType(){return this.displayType===N.EMOJI},isStarType(){return this.displayType===N.STAR}},mounted(){if(this.isRatingSubmitted){const{csat_survey_response:{rating:e,feedback_message:n}}=this.messageContentAttributes;this.selectedRating=e,this.feedback=n}},methods:{buttonClass(e){return[{selected:e.value===this.selectedRating},{disabled:this.isRatingSubmitted},{hover:this.isRatingSubmitted},"emoji-button"]},async onSubmit(){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{submittedValues:{csat_survey_response:{rating:this.selectedRating,feedback_message:this.feedback}},messageId:this.messageId})}catch{}finally{this.isUpdating=!1}},selectRating(e){this.selectedRating=e.value,this.onSubmit()},selectStarRating(e){this.selectedRating=e,this.onSubmit()}}},Ms={class:"text-n-slate-12 text-sm font-medium pt-5 px-2.5 text-center"},Fs={key:0,class:"ratings flex justify-around py-5 px-4"},Os=["onClick"],Bs=["placeholder"],Ls=["disabled"];function js(e,n,s,u,i,t){const a=l("StarRating"),c=l("Spinner"),h=l("FluentIcon");return o(),r("div",{class:"customer-satisfaction w-full bg-n-background dark:bg-n-solid-3 shadow-[0_0.25rem_6px_rgba(50,50,93,0.08),0_1px_3px_rgba(0,0,0,0.05)] ltr:rounded-bl-[0.25rem] rtl:rounded-br-[0.25rem] rounded-lg inline-block leading-[1.5] mt-1 border-t-2 border-t-n-brand border-solid",style:v({borderColor:e.widgetColor})},[d("h6",Ms,_(t.title),1),t.isEmojiType?(o(),r("div",Fs,[(o(!0),r(w,null,E(i.ratings,b=>(o(),r("button",{key:b.key,class:C(t.buttonClass(b)),onClick:k=>t.selectRating(b)},_(b.emoji),11,Os))),128))])):t.isStarType?(o(),p(a,{key:1,"selected-rating":i.selectedRating,"is-disabled":t.isRatingSubmitted,onSelectRating:t.selectStarRating},null,8,["selected-rating","is-disabled","onSelectRating"])):m("v-if",!0),t.isFeedbackSubmitted?m("v-if",!0):(o(),r("form",{key:2,class:"feedback-form flex",onSubmit:n[2]||(n[2]=q(b=>t.onSubmit(),["prevent"]))},[x(d("input",{"onUpdate:modelValue":n[0]||(n[0]=b=>i.feedback=b),placeholder:e.$t("CSAT.PLACEHOLDER"),onKeydown:n[1]||(n[1]=V((...b)=>t.onSubmit&&t.onSubmit(...b),["enter"]))},null,40,Bs),[[H,i.feedback]]),d("button",{class:"button small",disabled:t.isButtonDisabled,style:v({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating&&i.feedback?(o(),p(c,{key:0})):(o(),p(h,{key:1,icon:"chevron-right"}))],12,Ls)],32))],4)}const Us=g(Rs,[["render",js],["__scopeId","data-v-ae2c2c57"],["__file","/app/app/javascript/shared/components/CustomerSatisfaction.vue"]]),Ps={addParticipantToDyteMeeting:e=>{const s={url:`/api/v1/widget/integrations/dyte/add_participant_to_meeting${Se(window.location.search)}`};return ve.post(s.url,{message_id:e})}},Vs={components:{FluentIcon:A},props:{messageId:{type:Number,required:!0}},data(){return{isLoading:!1,dyteAuthToken:"",isSDKMounted:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},meetingLink(){return _e(this.dyteAuthToken)}},methods:{async joinTheCall(){this.isLoading=!0;try{const e=await Ps.addParticipantToDyteMeeting(this.messageId),{data:{token:n}={}}=e;this.dyteAuthToken=n}catch{}finally{this.isLoading=!1}},leaveTheRoom(){this.dyteAuthToken=""}}},Ds=["is-loading"],$s={key:0,class:"video-call--container"},Ns=["src"];function Ws(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",null,[d("button",{class:"button join-call-button","color-scheme":"secondary","is-loading":i.isLoading,style:v({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...c)=>t.joinTheCall&&t.joinTheCall(...c))},[f(a,{icon:"video-add",class:"rtl:ml-2 ltr:mr-2"}),U(" "+_(e.$t("INTEGRATIONS.DYTE.CLICK_HERE_TO_JOIN")),1)],12,Ds),i.dyteAuthToken?(o(),r("div",$s,[d("iframe",{src:t.meetingLink,allow:"camera;microphone;fullscreen;display-capture;picture-in-picture;clipboard-write;"},null,8,Ns),d("button",{class:"button small join-call-button leave-room-button",onClick:n[1]||(n[1]=(...c)=>t.leaveTheRoom&&t.leaveTheRoom(...c))},_(e.$t("INTEGRATIONS.DYTE.LEAVE_THE_ROOM")),1)])):m("v-if",!0)])}const zs=g(Vs,[["render",Ws],["__scopeId","data-v-10f0c4f7"],["__file","/app/app/javascript/widget/components/template/IntegrationCard.vue"]]),Hs={name:"AgentMessageBubble",components:{ChatArticle:Ss,ChatCard:Xt,ChatForm:rs,ChatOptions:_s,EmailInput:xs,CustomerSatisfaction:Us,IntegrationCard:zs},props:{message:{type:String,default:null},contentType:{type:String,default:null},messageType:{type:Number,default:null},messageId:{type:Number,default:null},messageContentAttributes:{type:Object,default:()=>{}}},setup(){const{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:u}=D();return{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:u}},computed:{isTemplate(){return this.messageType===3},isTemplateEmail(){return this.contentType==="input_email"},isCards(){return this.contentType==="cards"},isOptions(){return this.contentType==="input_select"},isForm(){return this.contentType==="form"},isArticle(){return this.contentType==="article"},isCSAT(){return this.contentType==="input_csat"},isIntegrations(){return this.contentType==="integrations"}},methods:{onResponse(e){this.$store.dispatch("message/update",e)},onOptionSelect(e){this.onResponse({submittedValues:[e],messageId:this.messageId})},onFormSubmit(e){const n=Object.keys(e).map(s=>({name:s,value:e[s]}));this.onResponse({submittedValues:n,messageId:this.messageId})}}},qs={class:"chat-bubble-wrap"},Gs={key:0,class:"chat-bubble agent bg-n-background dark:bg-n-solid-3 text-n-slate-12"},Ys={class:"message-content text-n-slate-12"},Xs={key:1},Ks={key:3},Js={key:4};function Zs(e,n,s,u,i,t){const a=l("EmailInput"),c=l("IntegrationCard"),h=l("ChatOptions"),b=l("ChatForm"),k=l("ChatCard"),R=l("ChatArticle"),I=l("CustomerSatisfaction"),B=j("dompurify-html");return o(),r("div",qs,[!t.isCards&&!t.isOptions&&!t.isForm&&!t.isArticle&&!t.isCards&&!t.isCSAT?(o(),r("div",Gs,[x(d("div",Ys,null,512),[[B,u.formatMessage(s.message,!1)]]),t.isTemplateEmail?(o(),p(a,{key:0,"message-id":s.messageId,"message-content-attributes":s.messageContentAttributes},null,8,["message-id","message-content-attributes"])):m("v-if",!0),t.isIntegrations?(o(),p(c,{key:1,"message-id":s.messageId,"meeting-data":s.messageContentAttributes.data},null,8,["message-id","meeting-data"])):m("v-if",!0)])):m("v-if",!0),t.isOptions?(o(),r("div",Xs,[f(h,{title:s.message,options:s.messageContentAttributes.items,"hide-fields":!!s.messageContentAttributes.submitted_values,onOptionSelect:t.onOptionSelect},null,8,["title","options","hide-fields","onOptionSelect"])])):m("v-if",!0),t.isForm&&!s.messageContentAttributes.submitted_values?(o(),p(b,{key:2,items:s.messageContentAttributes.items,"button-label":s.messageContentAttributes.button_label,"submitted-values":s.messageContentAttributes.submitted_values,onSubmit:t.onFormSubmit},null,8,["items","button-label","submitted-values","onSubmit"])):m("v-if",!0),t.isCards?(o(),r("div",Ks,[(o(!0),r(w,null,E(s.messageContentAttributes.items,y=>(o(),p(k,{key:y.title,"media-url":y.media_url,title:y.title,description:y.description,actions:y.actions},null,8,["media-url","title","description","actions"]))),128))])):m("v-if",!0),t.isArticle?(o(),r("div",Js,[f(R,{items:s.messageContentAttributes.items},null,8,["items"])])):m("v-if",!0),t.isCSAT?(o(),p(I,{key:5,"message-content-attributes":s.messageContentAttributes.submitted_values,"display-type":s.messageContentAttributes.display_type,message:s.message,"message-id":s.messageId},null,8,["message-content-attributes","display-type","message","message-id"])):m("v-if",!0)])}const Qs=g(Hs,[["render",Zs],["__file","/app/app/javascript/widget/components/AgentMessageBubble.vue"]]),en={name:"AgentMessage",components:{AgentMessageBubble:Qs,ImageBubble:ee,VideoBubble:te,Avatar:xe,UserMessage:ae,FileBubble:se,MessageReplyButton:Q,ReplyToChip:oe},mixins:[J,ne],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{shouldDisplayAgentMessage(){return this.contentType==="input_select"&&this.messageContentAttributes.submitted_values&&!this.message.content?!1:this.message.content},readableTime(){const{created_at:e=""}=this.message;return K(e,"LLL d yyyy, h:mm a")},messageType(){const{message_type:e=1}=this.message;return e},contentType(){const{content_type:e=""}=this.message;return e},agentName(){return this.message.sender?this.message.sender.available_name||this.message.sender.name:this.useInboxAvatarForBot?this.channelConfig.websiteName:this.$t("UNREAD_VIEW.BOT")},avatarUrl(){const e=this.useInboxAvatarForBot?this.inboxAvatarUrl:"/assets/images/chatwoot_bot.png";return this.message.message_type===Z.TEMPLATE?e:this.message.sender?this.message.sender.avatar_url:e},hasRecordedResponse(){return this.messageContentAttributes.submitted_email||this.messageContentAttributes.submitted_values&&!["form","input_csat"].includes(this.contentType)},responseMessage(){if(this.messageContentAttributes.submitted_email)return{content:this.messageContentAttributes.submitted_email};if(this.messageContentAttributes.submitted_values&&this.contentType==="input_select"){const[e={}]=this.messageContentAttributes.submitted_values;return{content:e.title||e.value}}return""},isASubmittedForm(){return Re(this.message)},submittedFormValues(){return this.messageContentAttributes.submitted_values.map(e=>({id:e.name,content:e.value}))},wrapClass(){return{"has-text":this.shouldDisplayAgentMessage}},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){M.emit(F.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},tn={key:0,class:"agent-message"},sn={class:"avatar-wrap"},nn={class:"user-thumbnail-box"},on={class:"message-wrap"},an={key:0,class:"flex mt-2 mb-1 text-xs"},rn={class:"flex w-full gap-1"},ln={key:2,controls:"",class:"h-10 dark:invert"},dn=["src"],cn={class:"flex flex-col justify-end"},un={key:1,class:"agent-name text-n-slate-11"},mn={key:2};function pn(e,n,s,u,i,t){var G;const a=l("Avatar"),c=l("ReplyToChip"),h=l("AgentMessageBubble"),b=l("ImageBubble"),k=l("VideoBubble"),R=l("FileBubble"),I=l("MessageReplyButton"),B=l("UserMessage"),y=j("dompurify-html");return o(),r("div",{class:C(["agent-message-wrap group",{"has-response":t.hasRecordedResponse||t.isASubmittedForm}])},[t.isASubmittedForm?m("v-if",!0):(o(),r("div",tn,[d("div",sn,[d("div",nn,[s.message.showAvatar||t.hasRecordedResponse?(o(),p(a,{key:0,src:t.avatarUrl,size:24,name:t.agentName,"rounded-full":""},null,8,["src","name"])):m("v-if",!0)])]),d("div",on,[t.hasReplyTo?(o(),r("div",an,[f(c,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("v-if",!0),d("div",rn,[d("div",{class:C(["space-y-2",{"w-full":t.contentType==="form"&&!((G=e.messageContentAttributes)!=null&&G.submitted_values)}])},[t.shouldDisplayAgentMessage?(o(),p(h,{key:0,"content-type":t.contentType,"message-content-attributes":e.messageContentAttributes,"message-id":s.message.id,"message-type":t.messageType,message:s.message.content},null,8,["content-type","message-content-attributes","message-id","message-type","message"])):m("v-if",!0),e.hasAttachments?(o(),r("div",{key:1,class:C(["space-y-2 chat-bubble has-attachment agent bg-n-background dark:bg-n-solid-3",t.wrapClass])},[(o(!0),r(w,null,E(s.message.attachments,S=>(o(),r("div",{key:S.id},[S.file_type==="image"&&!i.hasImageError?(o(),p(b,{key:0,url:S.data_url,thumb:S.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("v-if",!0),S.file_type==="video"&&!i.hasVideoError?(o(),p(k,{key:1,url:S.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):S.file_type==="audio"?(o(),r("audio",ln,[d("source",{src:S.data_url},null,8,dn)])):(o(),p(R,{key:3,url:S.data_url},null,8,["url"]))]))),128))],2)):m("v-if",!0)],2),d("div",cn,[f(I,{class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])])]),s.message.showAvatar||t.hasRecordedResponse?x((o(),r("p",un,null,512)),[[y,t.agentName]]):m("v-if",!0)])])),t.hasRecordedResponse?(o(),p(B,{key:1,message:t.responseMessage},null,8,["message"])):m("v-if",!0),t.isASubmittedForm?(o(),r("div",mn,[(o(!0),r(w,null,E(t.submittedFormValues,S=>(o(),p(B,{key:S.id,message:S},null,8,["message"]))),128))])):m("v-if",!0)],2)}const gn=g(en,[["render",pn],["__file","/app/app/javascript/widget/components/AgentMessage.vue"]]),hn={components:{AgentMessage:gn,UserMessage:ae},props:{message:{type:Object,default:()=>{}}},computed:{...T({allMessages:"conversation/getConversation"}),isUserMessage(){return this.message.message_type===Z.INCOMING},replyTo(){var n,s;const e=(s=(n=this.message)==null?void 0:n.content_attributes)==null?void 0:s.in_reply_to;return e?this.allMessages[e]:null}}};function _n(e,n,s,u,i,t){const a=l("UserMessage"),c=l("AgentMessage");return t.isUserMessage?(o(),p(a,{key:0,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"])):(o(),p(c,{key:1,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"]))}const fn=g(hn,[["render",_n],["__scopeId","data-v-fb125534"],["__file","/app/app/javascript/widget/components/ChatMessage.vue"]]),bn={name:"AgentTypingBubble"},yn={class:"agent-message-wrap sticky bottom-1"};function vn(e,n,s,u,i,t){return o(),r("div",yn,n[0]||(n[0]=[me('<div class="agent-message" data-v-6eece1a0><div class="avatar-wrap" data-v-6eece1a0></div><div class="message-wrap mt-2" data-v-6eece1a0><div class="chat-bubble agent typing-bubble bg-n-background dark:bg-n-solid-3" data-v-6eece1a0><img src="'+fe+'" alt="Agent is typing a message" class="!w-full" data-v-6eece1a0></div></div></div>',1)]))}const Cn=g(bn,[["render",vn],["__scopeId","data-v-6eece1a0"],["__file","/app/app/javascript/widget/components/AgentTypingBubble.vue"]]),Tn={props:{date:{type:String,required:!0}},computed:{formattedDate(){return Me({date:this.date,todayText:this.$t("TODAY"),yesterdayText:this.$t("YESTERDAY")})}}},kn={class:"text-sm text-n-slate-11 h-[50px] leading-[50px] relative text-center w-full before:content-[''] before:h-px before:absolute before:top-6 before:w-[calc((100%-120px)/2)] before:bg-n-slate-4 before:dark:bg-n-slate-6 before:left-0 after:content-[''] after:h-px after:absolute after:top-6 after:w-[calc((100%-120px)/2)] after:bg-n-slate-4 after:dark:bg-n-slate-6 after:right-0"};function Sn(e,n,s,u,i,t){return o(),r("div",kn,_(t.formattedDate),1)}const wn=g(Tn,[["render",Sn],["__file","/app/app/javascript/shared/components/DateSeparator.vue"]]),En={name:"ConversationWrap",components:{ChatMessage:fn,AgentTypingBubble:Cn,DateSeparator:wn,Spinner:L},props:{groupedMessages:{type:Array,default:()=>[]}},setup(){const{darkMode:e}=Ce();return{darkMode:e}},data(){return{previousScrollHeight:0,previousConversationSize:0}},computed:{...T({earliestMessage:"conversation/getEarliestMessage",lastMessage:"conversation/getLastMessage",allMessagesLoaded:"conversation/getAllMessagesLoaded",isFetchingList:"conversation/getIsFetchingList",conversationSize:"conversation/getConversationSize",isAgentTyping:"conversation/getIsAgentTyping",conversationAttributes:"conversationAttributes/getConversationParams"}),colorSchemeClass(){return`${this.darkMode==="dark"?"dark-scheme":"light-scheme"}`},showStatusIndicator(){const{status:e}=this.conversationAttributes,n=e==="pending",s=this.lastMessage.message_type===le.INCOMING;return this.isAgentTyping||n&&s}},watch:{allMessagesLoaded(){this.previousScrollHeight=0}},mounted(){this.$el.addEventListener("scroll",this.handleScroll),this.scrollToBottom()},updated(){this.previousConversationSize!==this.conversationSize&&(this.previousConversationSize=this.conversationSize,this.scrollToBottom())},unmounted(){this.$el.removeEventListener("scroll",this.handleScroll)},methods:{...W("conversation",["fetchOldConversations"]),scrollToBottom(){const e=this.$el;e.scrollTop=e.scrollHeight-this.previousScrollHeight,this.previousScrollHeight=0},handleScroll(){this.isFetchingList||this.allMessagesLoaded||!this.conversationSize||this.$el.scrollTop<100&&(this.fetchOldConversations({before:this.earliestMessage.id}),this.previousScrollHeight=this.$el.scrollHeight)}}},An={key:0,class:"message--loader"};function In(e,n,s,u,i,t){const a=l("Spinner"),c=l("DateSeparator"),h=l("ChatMessage"),b=l("AgentTypingBubble");return o(),r("div",{class:C(["conversation--container",t.colorSchemeClass])},[d("div",{class:C(["conversation-wrap",{"is-typing":e.isAgentTyping}])},[e.isFetchingList?(o(),r("div",An,[f(a)])):m("v-if",!0),(o(!0),r(w,null,E(s.groupedMessages,k=>(o(),r("div",{key:k.date,class:"messages-wrap"},[f(c,{date:k.date},null,8,["date"]),(o(!0),r(w,null,E(k.messages,R=>(o(),p(h,{key:R.id,message:R},null,8,["message"]))),128))]))),128)),t.showStatusIndicator?(o(),p(b,{key:1})):m("v-if",!0)],2)],2)}const xn=g(En,[["render",In],["__scopeId","data-v-0d952b03"],["__file","/app/app/javascript/widget/components/ConversationWrap.vue"]]),Rn={components:{ChatFooter:Qe,ConversationWrap:xn},computed:{...T({groupedMessages:"conversation/getGroupedConversation"})},mounted(){this.$store.dispatch("conversation/setUserLastSeen")}},Mn={class:"flex flex-col flex-1 overflow-hidden rounded-b-lg bg-n-slate-2 dark:bg-n-solid-1"},Fn={class:"flex flex-1 overflow-auto"};function On(e,n,s,u,i,t){const a=l("ConversationWrap"),c=l("ChatFooter");return o(),r("div",Mn,[d("div",Fn,[f(a,{"grouped-messages":e.groupedMessages},null,8,["grouped-messages"])]),f(c,{class:"px-5"})])}const Qn=g(Rn,[["render",On],["__file","/app/app/javascript/widget/views/Messages.vue"]]);export{Qn as default};
